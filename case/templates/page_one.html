{% extends "base.html" %}
{% block title %}
    <title>Page One | Fabelio Coding Test</title>
{% endblock %}

{% block page_content %}
<div class="container" style="margin-top: 15%">
    <form class="form-group" id="search-form" method="post" name="searchForm">
        {% csrf_token %}
        <div class="input-box col-lg-12">
            <div class="alert alert-danger alert-dismissible fade {% if error_message %}show{% endif %}" role="alert">
                <strong class='error-message'>{{ error_message }}</strong>
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="row search-row">
                    <div class="col-md-8">
                        <input type="text" class="link-input form-control" name="input" placeholder="Input link of Fabelio items...">
                    </div>
                    <div class="col-md-4">
                        <input type="submit" class="btn btn-case" value="Search">
                    </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block js %}
    {% load staticfiles %}
    <script src="{% static 'js/jquery-loading/jquery.loading.min.js' %}"></script>
    <script>
    $('.btn-case').click(function (event) {
        event.preventDefault();
        var url = $('.link-input').val().toLowerCase();
        var $alert = $('.alert-danger');
        var $err = $('.error-message');

        if (url === "" && url.trim().length === 0){
            $err.html("Input should not be empty");
            if (!$alert.hasClass("show")){
                $alert.addClass("show");
            }
            return false;
        } else if (url.indexOf("fabelio.com") === -1){
            $err.html("Not a valid Fabelio link");
            if (!$alert.hasClass("show")){
                $alert.addClass("show");
            }
            return false;
        }

        $('body').loading();
        $('#search-form').submit();
    })
    </script>
{% endblock %}